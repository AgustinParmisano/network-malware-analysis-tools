#!/bin/bash

echo "<><><><><> Starting BLC <><><><><>"
usage="This scripts needs 2 parameters: 1 bro conn.log file and 2 result folder for the splits and labeled splits"

if [ $# -ne 2 ]; then
    echo $usage
    exit 1
fi

if [ ! -f $1 ]; then
    echo $usage
    exit 2
fi

if [ ! -d $2 ]; then
    echo $usage
    exit 3
fi

flows=$(wc -l $1 | cut -d" " -f1) 

echo "Bro Log File $1 has $flows"

cuts=$(($flows / 1000000))

echo "Bro Log File $1 with $flows will be cutted in $cuts files"

split -l 1000000 $1 $2/split

echo "Done $(($cuts - 1)) cuts stored at $2"

echo "Starting labeling script for each split"
for i in $(ls $2 | grep split); do 
    echo "Starting labeling script for split $i"
    python3 labeled_dataframe_assigner.py $2/$i
    echo "Done labeling for split $i"
done

echo "<><><><><> Stopping BLC <><><><><>"
